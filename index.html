<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huy ezgg - V9.1 PRO (Fixed Stats)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #0f172a; --card-bg: #1e293b;
            --primary: #6366f1; --accent: #ec4899; --success: #10b981;
            --danger: #ef4444; --text: #f8fafc; --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-user-select: none; user-select: none; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- HEADER --- */
        .header {
            height: 70px; background: rgba(15, 23, 42, 0.9); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 30px;
            backdrop-filter: blur(10px); z-index: 100;
        }
        .logo { font-weight: 800; font-size: 20px; color: var(--accent); letter-spacing: 1px; text-transform: uppercase; }
        
        .user-switch { display: flex; background: #334155; padding: 4px; border-radius: 20px; gap: 5px; }
        .role-btn { padding: 6px 15px; border-radius: 16px; font-size: 12px; font-weight: 600; cursor: pointer; transition: 0.3s; color: #94a3b8; }
        .role-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 10px rgba(99, 102, 241, 0.4); }

        /* --- CONTAINER --- */
        .container { flex: 1; position: relative; overflow-y: auto; padding: 20px; }
        .screen { display: none; animation: fadeIn 0.4s ease; max-width: 800px; margin: 0 auto; }
        .screen.active { display: block; }

        /* --- HOME SCREEN --- */
        .hero-section { text-align: center; margin-bottom: 25px; }
        .hero-title { font-size: 32px; margin: 0 0 5px 0; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .exp-tag { color: #fbbf24; font-weight: bold; font-size: 13px; background: rgba(251, 191, 36, 0.1); padding: 5px 15px; border-radius: 20px; display: inline-block; }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .menu-card {
            background: var(--card-bg); border-radius: 24px; padding: 20px; border: 1px solid var(--border);
            cursor: pointer; transition: 0.3s; text-align: center; height: 200px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .menu-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .menu-icon { font-size: 50px; margin-bottom: 10px; }

        /* --- WHEEL --- */
        .wheel-wrap { position: relative; width: 300px; height: 300px; margin: 20px auto; }
        #wheelCanvas { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #334155; transform: rotate(-90deg); }
        .wheel-arrow { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); z-index: 10; font-size: 35px; color: white; }

        /* --- STATS STYLES (THE FIXED PART) --- */
        .stat-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-box { flex: 1; min-width: 100px; background: #334155; padding: 15px; border-radius: 12px; text-align: center; border-bottom: 3px solid transparent; }
        .stat-box small { font-size: 10px; color: var(--text-dim); text-transform: uppercase; }
        .stat-val { font-size: 16px; font-weight: 800; margin-top: 5px; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; border-bottom: 1px solid var(--border); text-align: left; }
        th { background: rgba(255,255,255,0.05); color: var(--text-dim); }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: 800; text-transform: uppercase; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-menu { background: #334155; color: white; margin-bottom: 20px; width: auto; padding: 10px 30px; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal { background: var(--card-bg); padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--border); }
        
        .bag-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .bag-item { height: 80px; background: linear-gradient(135deg, #f472b6, #db2777); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; animation: bounce 0.6s infinite alternate; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="header">
        <div class="logo">HUY EZGG üå∏</div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <div class="user-switch">
                <div class="role-btn active" id="btn-guest" onclick="switchAcc('guest')">Kh√°ch</div>
                <div class="role-btn" id="btn-admin" onclick="switchAcc('admin')">Admin</div>
            </div>
            <button id="btn-stats" onclick="nav('stats')" style="background:none; border:none; color:#94a3b8; cursor:pointer; font-size:22px; display:none;">üìä</button>
        </div>
    </div>

    <div class="container">
        
        <div id="screen-home" class="screen active">
            <div class="hero-section">
                <h1 class="hero-title" id="welcome-text">Xin ch√†o!</h1>
                <div id="guest-notice" class="exp-tag">ƒê√¢y l√† ch∆°i tr·∫£i nghi·ªám, h√£y ƒë·∫øn l·ªõp 8/1 ƒë·ªÉ mua th·∫≠t nh√©! 1!</div>
            </div>

            <center><button class="btn btn-menu" onclick="document.getElementById('menu-modal').style.display='flex'">üìã MENU C·ª¶A QU√ÅN</button></center>
            
            <div class="menu-grid">
                <div class="menu-card" onclick="nav('bag')">
                    <div class="menu-icon">üõçÔ∏è</div>
                    <div class="menu-title">T√∫i M√π (20K)</div>
                </div>
                <div class="menu-card" onclick="nav('wheel')">
                    <div class="menu-icon">üé°</div>
                    <div class="menu-title">V√≤ng Quay</div>
                </div>
            </div>
        </div>

        <div id="screen-bag" class="screen">
            <div style="cursor:pointer; margin-bottom:15px; color:var(--text-dim);" onclick="nav('home')">‚Üê Quay l·∫°i</div>
            <div class="game-container" style="text-align:center;">
                <h2 style="color: var(--accent);">CH·ªåN LO·∫†I T√öI M√ô (20K)</h2>
                <div style="display: flex; flex-direction: column; gap: 10px; max-width:300px; margin:auto;">
                    <button class="btn" style="background: #334155; color: white;" onclick="openSelector('N∆∞·ªõc')">ü•§ N∆∞·ªõc Gi·∫£i Kh√°t</button>
                    <button class="btn" style="background: #334155; color: white;" onclick="openSelector('ƒê·ªì ƒÇn')">üå≠ ƒê·ªì ƒÇn V·∫∑t</button>
                    <button class="btn" style="background: #334155; color: white;" onclick="openSelector('Tr√°ng Mi·ªáng')">üçÆ Tr√°ng Mi·ªáng</button>
                </div>
            </div>
        </div>

        <div id="screen-wheel" class="screen">
            <div style="cursor:pointer; margin-bottom:15px; color:var(--text-dim);" onclick="nav('home')">‚Üê Quay l·∫°i</div>
            <div class="game-container" style="text-align:center;">
                <h2 style="color: var(--primary);">V√íNG QUAY MAY M·∫ÆN</h2>
                <div class="wheel-wrap">
                    <div class="wheel-arrow">‚ñº</div>
                    <canvas id="wheelCanvas" width="320" height="320"></canvas>
                </div>
                <button class="btn btn-primary" id="spin-btn" style="width: 200px; margin:auto;" onclick="playWheel()">QUAY NGAY</button>
            </div>
        </div>

        <div id="screen-stats" class="screen">
            <div style="cursor:pointer; margin-bottom:15px; color:var(--text-dim);" onclick="nav('home')">‚Üê Quay l·∫°i</div>
            <h2 style="margin-bottom:20px;">üìä B√ÅO C√ÅO CHI TI·∫æT</h2>
            
            <div class="stat-bar">
                <div class="stat-box" style="border-bottom-color: var(--success);">
                    <small>Doanh thu</small>
                    <div id="total-rev" class="stat-val" style="color:var(--success);">0ƒë</div>
                </div>
                <div class="stat-box" style="border-bottom-color: var(--danger);">
                    <small>Gi√° v·ªën qu√†</small>
                    <div id="total-cost" class="stat-val" style="color:var(--danger);">0ƒë</div>
                </div>
                <div class="stat-box" id="profit-box" style="border-bottom-color: var(--primary);">
                    <small>L·ª£i nhu·∫≠n</small>
                    <div id="total-profit" class="stat-val" style="color:var(--primary);">0ƒë</div>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table>
                    <thead><tr><th>Th·ªùi gian</th><th>Lo·∫°i/M√≥n</th><th>Gi√° v·ªën</th><th>X√≥a</th></tr></thead>
                    <tbody id="stat-table"></tbody>
                </table>
            </div>
            <button class="btn" style="margin-top:20px; background:#ef4444; color:white; padding:10px;" onclick="clearStats()">X√ìA T·∫§T C·∫¢ D·ªÆ LI·ªÜU</button>
        </div>
    </div>

    <div id="menu-modal" class="overlay">
        <div class="modal">
            <h2 style="color:var(--primary)">üìã MENU L·ªöP 8/1</h2>
            <div style="text-align:left; background:rgba(0,0,0,0.2); padding:15px; border-radius:12px; margin-bottom:15px; font-size:14px;">
                <p style="color:var(--accent); font-weight:800; border-bottom:1px solid var(--border);">ü•§ N∆Ø·ªöC GI·∫¢I KH√ÅT</p>
                <div style="display:flex; justify-content:space-between;"><span>Tr√† t·∫Øc</span><span>8k</span></div>
                <div style="display:flex; justify-content:space-between;"><span>Tr√† ƒë√†o</span><span>13k</span></div>
                <div style="display:flex; justify-content:space-between;"><span>Tr√† d√¢u</span><span>18k</span></div>
                
                <p style="color:var(--accent); font-weight:800; border-bottom:1px solid var(--border); margin-top:10px;">üå≠ ƒê·ªí ƒÇN V·∫∂T</p>
                <div style="display:flex; justify-content:space-between;"><span>Nem chua</span><span>9k</span></div>
                <div style="display:flex; justify-content:space-between;"><span>B√°nh l√°</span><span>12k</span></div>
                <div style="display:flex; justify-content:space-between;"><span>M·∫πt ƒÉn v·∫∑t</span><span>24k</span></div>

                <p style="color:var(--accent); font-weight:800; border-bottom:1px solid var(--border); margin-top:10px;">üçÆ TR√ÅNG MI·ªÜNG</p>
                <div style="display:flex; justify-content:space-between;"><span>Rau c√¢u</span><span>6k</span></div>
                <div style="display:flex; justify-content:space-between;"><span>S·ªØa chua</span><span>13k</span></div>
                <div style="display:flex; justify-content:space-between;"><span>Ch√® b∆∞·ªüi</span><span>17k</span></div>
            </div>
            <button class="btn btn-primary" onclick="document.getElementById('menu-modal').style.display='none'">ƒê√ìNG</button>
        </div>
    </div>

    <div id="auth-overlay" class="overlay">
        <div class="modal">
            <h3>X√ÅC TH·ª∞C ADMIN</h3>
            <input type="password" id="admin-pin" placeholder="Nh·∫≠p PIN..." style="width:100%; padding:15px; margin: 15px 0; border-radius:10px; border:1px solid #475569; background:#0f172a; color:white; text-align:center; font-size:20px;">
            <button class="btn btn-primary" onclick="checkPin()">X√ÅC NH·∫¨N</button>
            <button class="btn" style="background:none; color:var(--text-dim);" onclick="document.getElementById('auth-overlay').style.display='none'">H·ª¶Y</button>
        </div>
    </div>

    <div id="bag-selector" class="overlay">
        <div class="modal">
            <h3 style="color:white;">CH·ªåN 1 T√öI B·∫§T K·ª≤</h3>
            <div class="bag-grid" id="bag-grid"></div>
        </div>
    </div>

    <div id="res-modal" class="overlay" style="z-index: 10001;">
        <div class="modal">
            <div id="res-icon" style="font-size: 70px; margin-bottom: 10px;">üéÅ</div>
            <h3 id="res-name" style="color: var(--accent); font-size:24px;">---</h3>
            <div id="admin-actions" style="display:none; margin-top: 15px;">
                <button class="btn btn-primary" style="background:var(--success); margin-bottom:10px;" onclick="saveEntry(true)">L∆ØU V√ÄO DOANH THU</button>
            </div>
            <button class="btn btn-primary" style="background:#334155;" onclick="saveEntry(false)">ƒê√ìNG</button>
        </div>
    </div>

    <script>
        // CH·∫∂N F12 V√Ä CHU·ªòT PH·∫¢I
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0))) return false;
        };

        const ITEMS = {
            'N∆∞·ªõc': [ {name:"Tr√† t·∫Øc", cost:8000, gW:15, aW:75, icon:"üçπ"}, {name:"Tr√† ƒë√†o", cost:13000, gW:35, aW:20, icon:"üçë"}, {name:"Tr√† d√¢u", cost:18000, gW:50, aW:5, icon:"üçì"} ],
            'ƒê·ªì ƒÇn': [ {name:"Nem chua", cost:9000, gW:15, aW:75, icon:"üç¢"}, {name:"B√°nh l√°", cost:12000, gW:35, aW:20, icon:"ü´î"}, {name:"M·∫πt ƒÉn v·∫∑t", cost:24000, gW:50, aW:5, icon:"üç±"} ],
            'Tr√°ng Mi·ªáng': [ {name:"Rau c√¢u", cost:6000, gW:15, aW:75, icon:"üçÆ"}, {name:"S·ªØa chua", cost:13000, gW:35, aW:20, icon:"üç®"}, {name:"Ch√® b∆∞·ªüi", cost:17000, gW:50, aW:5, icon:"ü•£"} ],
            'Wheel': [
                {name:"K·∫πo m√∫t", cost:1000, gW:30, aW:50, icon:"üç≠"}, {name:"Voucher 5k", cost:5000, gW:20, aW:15, icon:"üéüÔ∏è"},
                {name:"Voucher 10k", cost:10000, gW:10, aW:5, icon:"üéüÔ∏è"}, {name:"M·∫•t l∆∞·ª£t", cost:0, gW:40, aW:30, icon:"‚ùå"},
                {name:"K·∫πo m√∫t", cost:1000, gW:30, aW:50, icon:"üç≠"}, {name:"Voucher 5k", cost:5000, gW:20, aW:15, icon:"üéüÔ∏è"},
                {name:"Voucher 10k", cost:10000, gW:10, aW:5, icon:"üéüÔ∏è"}, {name:"M·∫•t l∆∞·ª£t", cost:0, gW:40, aW:30, icon:"‚ùå"}
            ]
        };

        let isAdmin = false, pinUnlocked = false, isSpinning = false;
        let stats = JSON.parse(localStorage.getItem('hanami_v9_1')) || [];
        let pending = null;

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + id).classList.add('active');
            if(id === 'stats') renderStats();
        }

        function switchAcc(role) {
            if(role === 'admin') {
                if(pinUnlocked) activateAdmin();
                else document.getElementById('auth-overlay').style.display = 'flex';
            } else { isAdmin = false; updateHeader(); nav('home'); }
        }

        function checkPin() {
            if(document.getElementById('admin-pin').value === 'bi12345678') {
                pinUnlocked = true; activateAdmin();
                document.getElementById('auth-overlay').style.display = 'none';
            } else alert('Sai PIN!');
        }

        function activateAdmin() { isAdmin = true; updateHeader(); }

        function updateHeader() {
            document.getElementById('btn-guest').classList.toggle('active', !isAdmin);
            document.getElementById('btn-admin').classList.toggle('active', isAdmin);
            document.getElementById('btn-stats').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('guest-notice').style.display = isAdmin ? 'none' : 'inline-block';
            document.getElementById('welcome-text').innerText = isAdmin ? 'Xin ch√†o, Admin!' : 'Xin ch√†o!';
        }

        function drawWheel() {
            const ctx = document.getElementById('wheelCanvas').getContext('2d');
            const colors = ['#6366f1', '#ec4899', '#8b5cf6', '#f43f5e', '#6366f1', '#ec4899', '#8b5cf6', '#f43f5e'];
            const labels = ["K·∫∏O", "5K", "10K", "MISS", "K·∫∏O", "5K", "10K", "MISS"];
            ctx.clearRect(0,0,320,320);
            for(let i=0; i<8; i++) {
                ctx.beginPath(); ctx.fillStyle = colors[i]; ctx.moveTo(160,160);
                ctx.arc(160,160,150, i*(Math.PI/4), (i+1)*(Math.PI/4)); ctx.fill();
                ctx.save(); ctx.translate(160,160); ctx.rotate(i*(Math.PI/4) + Math.PI/8);
                ctx.fillStyle="white"; ctx.font="bold 12px Inter"; ctx.textAlign="right"; ctx.fillText(labels[i], 140, 5); ctx.restore();
            }
        }

        function playWheel() {
            if(isSpinning) return;
            const key = isAdmin ? 'aW' : 'gW';
            const pool = ITEMS['Wheel'];
            let total = pool.reduce((a,b)=>a+b[key],0), r = Math.random()*total, winIdx = 0;
            for(let i=0; i<pool.length; i++) { if(r<pool[i][key]) { winIdx=i; break; } r-=pool[i][key]; }
            
            pending = {...pool[winIdx], type: 'V√≤ng Quay', date: new Date().toLocaleTimeString()};
            isSpinning = true;
            const canvas = document.getElementById('wheelCanvas');
            const targetDeg = (winIdx * 45) + 22.5;
            const finalRotation = 3600 + (360 - targetDeg);
            
            canvas.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0.15, 1)';
            canvas.style.transform = `rotate(${finalRotation - 90}deg)`;
            
            setTimeout(() => {
                isSpinning = false; showResult();
                canvas.style.transition = 'none';
                canvas.style.transform = `rotate(${(finalRotation - 90) % 360}deg)`;
            }, 4100);
        }

        function openSelector(type) {
            const grid = document.getElementById('bag-grid'); grid.innerHTML = '';
            for(let i=0; i<9; i++) {
                const d = document.createElement('div'); d.className = 'bag-item'; d.innerText = 'üõçÔ∏è';
                d.onclick = () => {
                    const pool = ITEMS[type];
                    const key = isAdmin ? 'aW' : 'gW';
                    let total = pool.reduce((a,b)=>a+b[key],0), r = Math.random()*total, win = pool[0];
                    for(let x of pool) { if(r<x[key]) { win=x; break; } r-=x[key]; }
                    pending = {...win, type: 'T√∫i M√π', date: new Date().toLocaleTimeString()};
                    document.getElementById('bag-selector').style.display = 'none';
                    showResult();
                };
                grid.appendChild(d);
            }
            document.getElementById('bag-selector').style.display = 'flex';
        }

        function showResult() {
            document.getElementById('res-name').innerText = pending.name;
            document.getElementById('res-icon').innerText = pending.icon;
            document.getElementById('res-modal').style.display = 'flex';
            confetti({particleCount: 150, spread: 70});
            document.getElementById('admin-actions').style.display = isAdmin ? 'block' : 'none';
        }

        function saveEntry(save) {
            if(save && isAdmin) {
                stats.unshift(pending);
                localStorage.setItem('hanami_v9_1', JSON.stringify(stats));
            }
            document.getElementById('res-modal').style.display = 'none';
        }

        function renderStats() {
            const tbody = document.getElementById('stat-table'); tbody.innerHTML = '';
            let rev=0, cost=0;
            stats.forEach((s, i) => {
                const r = s.type === 'T√∫i M√π' ? 20000 : 0;
                rev += r; cost += s.cost;
                tbody.innerHTML += `<tr>
                    <td><small>${s.date}</small></td>
                    <td><b>${s.name}</b><br><small>${s.type}</small></td>
                    <td>-${s.cost.toLocaleString()}ƒë</td>
                    <td><button onclick="delStat(${i})" style="border:none; background:none; cursor:pointer;">üóëÔ∏è</button></td>
                </tr>`;
            });
            const profit = rev - cost;
            document.getElementById('total-rev').innerText = rev.toLocaleString() + 'ƒë';
            document.getElementById('total-cost').innerText = cost.toLocaleString() + 'ƒë';
            document.getElementById('total-profit').innerText = profit.toLocaleString() + 'ƒë';
            document.getElementById('total-profit').style.color = profit >= 0 ? 'var(--success)' : 'var(--danger)';
        }

        function delStat(i) { stats.splice(i,1); localStorage.setItem('hanami_v9_1', JSON.stringify(stats)); renderStats(); }
        function clearStats() { if(confirm('X√≥a h·∫øt d·ªØ li·ªáu doanh thu?')) { stats=[]; localStorage.setItem('hanami_v9_1', JSON.stringify(stats)); renderStats(); } }

        window.onload = drawWheel;
    </script>
</body>
</html>